# Playwright End-to-End Tests

This repository now includes Playwright UI smoke tests for the Blazor Server app. The tests exercise the login page, access control redirect, and the admin dashboard happy path.

## Prerequisites
- Node.js 18+ installed.
- .NET 8 SDK installed.
- SQL Server/SQL Express accessible at the connection string in `MegaMarket.API/appsettings.json` (defaults to `Server=.\SQLEXPRESS;Database=MegaMarket;...`). The API will auto-seed when empty.
- Ports `5023` (UI) and `5036` (API) available.

## Setup
1) Install dependencies (already done once, repeat after pulling new changes):
   ```bash
   npm install
   ```
2) Install Playwright browsers (needed on a fresh machine):
   ```bash
   npx playwright install chromium
   ```

## Running the tests
Playwright will start both servers for you (`dotnet run --project MegaMarket.API --launch-profile http` and `dotnet run --project MegaMarket.BlazorUI --launch-profile http`) and reuse them if already running.

```bash
npm run test:e2e
```

### Useful variants
- Headed/debug-friendly: `npm run test:e2e:headed`
- Run specific specs: `npm run test:e2e -- --grep "Login"`
- Visual test runner: `npm run test:e2e:ui`

## Configuration
- Base URL: set `E2E_BASE_URL` (or `PLAYWRIGHT_BASE_URL`) if your UI is not on `http://localhost:5023`.
- API URL: set `E2E_API_URL` (or `PLAYWRIGHT_API_URL`) if your API is not on `http://localhost:5036`.
- Admin credentials: set `E2E_ADMIN_USER` and `E2E_ADMIN_PASS` to override the defaults.
- Prerender toggle: Playwright sets `E2E_DISABLE_PRERENDER=1` for stable auth-based routing (disables prerender on `App.razor`).

## Test suite contents
- `playwright/tests/login.spec.ts`: renders login form; shows an error for invalid credentials.
- `playwright/tests/access-control.spec.ts`: unauthenticated users hitting `/` are redirected to `/login`.
- `playwright/tests/dashboard.spec.ts`: successful admin login lands on `/admin/dashboard` and displays dashboard content.
- `playwright/tests/logout.spec.ts`: logout returns to `/login` and clears `authToken`.
- `playwright/tests/role-routing.spec.ts`: manager/cashier/warehouse credentials route to their dashboards.
- `playwright/tests/profile.spec.ts`: authenticated user can navigate to `/profile`.
- `playwright/tests/products.spec.ts`: products page loads and filter controls are visible.
- `playwright/tests/sale.spec.ts`: sale (POS) page renders.
- `playwright/tests/invoice.spec.ts`: invoice page renders (cashier).
- `playwright/tests/loyalty.spec.ts`: loyalty dashboard renders.
- `playwright/tests/api-unavailable.spec.ts`: UI shows a friendly error when API is unreachable.

## Report output
- HTML report: `playwright-report/` (generated by default).
- Failure artifacts: `test-results/` (screenshots/videos on failure).
- Sample artifacts + doc report: `e2e-report/` (generated by the tests/report script; ignored by git).
